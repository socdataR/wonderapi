<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Simplifies the process of formulating CDC Wonder API query
    requests and interpreting query responses in order to obtain federal
    health data.">
<title>User Friendly Access to CDC Wonder API • wonderapi</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="User Friendly Access to CDC Wonder API">
<meta property="og:description" content="Simplifies the process of formulating CDC Wonder API query
    requests and interpreting query responses in order to obtain federal
    health data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">wonderapi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/D104codebook.html">D104 Heat Wave Days Dataset Codebook</a>
    <a class="dropdown-item" href="articles/D10codebook.html">D10 Natality for 1995 - 2002 Dataset Codebook</a>
    <a class="dropdown-item" href="articles/D149codebook.html">D149 Natality for 2016 - 2022 (expanded) Dataset Codebook</a>
    <a class="dropdown-item" href="articles/D176codebook.html">D176 Provisional Multiple Cause of Death Dataset Codebook</a>
    <a class="dropdown-item" href="articles/D27codebook.html">D27 Natality for 2003 - 2006 Dataset Codebook</a>
    <a class="dropdown-item" href="articles/D66codebook.html">D66 Natality for 2007 - 2022 Dataset Codebook</a>
    <a class="dropdown-item" href="articles/D76codebook.html">D76 Detailed Mortality Dataset Codebook</a>
    <a class="dropdown-item" href="articles/IntroVignette.html">Introduction to wonderapi</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/socdataR/wonderapi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="wonderapi">wonderapi<a class="anchor" aria-label="anchor" href="#wonderapi"></a>
</h1></div>
<p>Joyce Robbins 2022-03-24</p>
<div id="TOC">
<ul>
<li>
<a href="#overview">Overview</a>
<ul>
<li>
<a href="#example">Example</a>
</li>
</ul>
</li>
<li>
<a href="#installation">Installation</a>
</li>
<li>
<a href="#getting-started">Getting started</a>
<ul>
<li>
<a href="#codebooks">Codebooks</a>
</li>
<li>
<a href="#default-query-lists-and-requests">Default query lists and requests</a>
</li>
</ul>
</li>
<li>
<a href="#creating-customized-queries">Creating customized queries</a>
<ul>
<li>
<a href="#group-by-variables">Group By variables</a>
</li>
<li>
<a href="#measures">Measures</a>
</li>
<li>
<a href="#limiting-variables">Limiting variables</a>
</li>
<li>
<a href="#plotting-query-results">Plotting query results</a>
</li>
<li>
<a href="#combining-results-from-multiple-datasets">Combining results from multiple datasets</a>
</li>
<li>
<a href="#errors">Errors</a>
</li>
</ul>
</li>
</ul>
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/socdataR/wonderapi" class="external-link">wonderapi</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This package makes it easier to use the CDC Wonder API. It does so by employing hidden default query lists and lookup tables, allowing users to focus only on the variables they’re interested in obtaining, and to write queries using human readable names rather than numeric codes.</p>
<p><code><a href="reference/getData.html">getData()</a></code></p>
<ul>
<li>converts the user’s parameter requests to codes<br>
</li>
<li>adds these codes to the default query list<br>
</li>
<li>calls the WONDER API to obtain query results</li>
<li>processes the results<br>
</li>
<li>returns a tidy data frame</li>
</ul>
</div>
<div class="section level2">
<h2 id="limitations-of-the-cdc-wonder-api">Limitations of the CDC WONDER API<a class="anchor" aria-label="anchor" href="#limitations-of-the-cdc-wonder-api"></a>
</h2>
<p>Note that queries for mortality and births statistics from the National Vital Statistics System cannot limit or group results by any location field, such as Region, Division, State or County, or Urbanization (urbanization categories map to specific geographic counties). See: <a href="https://wonder.cdc.gov/wonder/help/WONDER-API.html" class="external-link uri">https://wonder.cdc.gov/wonder/help/WONDER-API.html</a> for more information.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"And By"</span>, <span class="st">"Gender"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydata0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Detailed Mortality"</span>, <span class="va">mylist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 5</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">##   Year  Gender  Deaths Population `Crude Rate`</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">## 1 1999  Female 1215860  142237295         855.</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">## 2 1999  Male   1175183  136802873         859 </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">## 3 2000  Female 1225706  143368343         855.</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="do">## 4 2000  Male   1177289  138053563         853.</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="do">## 5 2001  Female 1232913  145077463         850.</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="do">## 6 2001  Male   1183090  139891492         846.</span></span></code></pre></div>
<p><code><a href="reference/show_databases.html">show_databases()</a></code> displays available databases by name and code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">wonderapi</span><span class="fu">::</span><span class="fu"><a href="reference/show_databases.html">show_databases</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## # A tibble: 7 × 2</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">##   label                               name </span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                               &lt;chr&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="do">## 1 Natality for 1995 - 2002            D10  </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="do">## 2 Natality for 2003 - 2006            D27  </span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="do">## 3 Natality for 2007 - 2022            D66  </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="do">## 4 Natality for 2016 - 2022 (expanded) D149 </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="do">## 5 Detailed Mortality                  D76  </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="do">## 6 Provisional Multiple Cause of Death D176 </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="do">## 7 Heat Wave Days                      D104</span></span></code></pre></div>
<p>More databases will be added in the future.</p>
<p>The best way to become familiar with CDC Wonder API options is to use the web interface: <a href="https://wonder.cdc.gov" class="external-link uri">https://wonder.cdc.gov</a>, as the options available through the API are nearly identical. The greatest difference is that location variables are not available through the API.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This package is not on CRAN. It can be installed from Github with the <code>devtools</code> package:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"socdataR/wonderapi"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>(The vignettes are an important component of the package as the codebooks are stored as vignettes, so be sure to include <code>build_vignettes = TRUE</code>.)</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Queries are composed of parameter name-value pairs. Setting up a query without assistance is complex because the query must be submitted as an .xml file with a long list of required parameters, such as <a href="https://wonder.cdc.gov/wonder/help/API-Examples/D76_Example1-req.xml" class="external-link">here (Example 1)</a> and <a href="https://wonder.cdc.gov/wonder/help/API-Examples/D76_Example2-req.xml" class="external-link">here (Example 2)</a>. The point of the package is to prevent your having to create requests in this form. The code for converting R lists to xml and making the actual query is borrowed from the <a href="https://github.com/hrbrmstr/wondr" class="external-link"><code>wondr</code> package</a>. The value of this package is in the “pre” and “post” stages of the query, that is, the processes of setting up the query and tidying the results.</p>
<div class="section level3">
<h3 id="codebooks">Codebooks<a class="anchor" aria-label="anchor" href="#codebooks"></a>
</h3>
<p>Codebooks are provided as package vignettes to allow the user to conveniently look up the names and values of available parameters in each dataset. They may be accessed quickly by typing:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">&gt;</span> ??codebook</span></code></pre></div>
<p>in the console, or searching for “<code>codebook</code>” in the Help window. The codebooks are an important contribution of the package and are not provided by the CDC. They are generated automatically by <a href="https://github.com/socdataR/wonderapi/blob/develop/R/make_codebook_vignette.R" class="external-link">this script</a>, which scrapes the CDC Wonder web interface form, and displays parameter names and values in human readable form. The benefit of this method is the ability to quickly produce and update codebook vignettes that closely follow the web interface, with parameters appearing in the same order. It also means, however, that the codebooks contain more information than the typical user needs to submit a query. Most users will only need Group By variables (codes beginning with “B_”), Measures (codes beginning with “M_”), and Limiting Variables (codes beginning with “V_”).</p>
<p>Although some of the parameter names are long and/or awkward, for the sake of consistency, we follow the CDC names exactly. <strong>The only exception is that any content that appears in parentheses should be dropped.</strong> For example, “Fertility Rate” can be substituted for “M_5”, but “Fertility Rate (Census Region, Census Division, HHS Region, State, County, Year, Age of Mother, Race) cannot.</p>
</div>
<div class="section level3">
<h3 id="default-query-lists-and-requests">Default query lists and requests<a class="anchor" aria-label="anchor" href="#default-query-lists-and-requests"></a>
</h3>
<p>To facilitate the process of designing a query list, this package relies on default query lists. Each default query is set to request a single Group By Results parameter, generally set to <code>"Year"</code>. It is set to request the Measures that are listed as default Measures on the web interface (i.e. <code>Births</code> for <a href="https://wonder.cdc.gov/controller/datarequest/D76" class="external-link">the Births dataset</a>; <code>Deaths</code>, <code>Population</code> and <code>Crude Rate</code> for the <a href="https://wonder.cdc.gov/controller/datarequest/D76" class="external-link">Detailed Mortality dataset</a>.) To see the default settings, perform a query request without specifying a querylist:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">natdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 2007 - 2022"</span><span class="op">)</span></span>
<span><span class="va">natdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 2</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="do">##    Year  Births</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="do">##   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="do">## 1  2007 4316233</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="do">## 2  2008 4247694</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="do">## 3  2009 4130665</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="do">## 4  2010 3999386</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="do">## 5  2011 3953590</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="do">## 6  2012 3952841</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Detailed Mortality"</span><span class="op">)</span></span>
<span><span class="va">dmdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 4</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="do">##   Year   Deaths Population `Crude Rate`</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="do">## 1 1999  2391043  279040168         857.</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="do">## 2 2000  2402995  281421906         854.</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="do">## 3 2001  2416003  284968955         848.</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="do">## 4 2002  2443030  287625193         849.</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="do">## 5 2003  2447946  290107933         844.</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="do">## 6 2004  2397269  292805298         819.</span></span></code></pre></div>
<p>The default lists were prepared based on CDC examples, but we make no claim that they are error free. If you have any suggestions for improving them, please make a pull request on Github or <a href="mailto:joycerobbins1@gmail.com">send an email to Joyce Robbins</a>. The default lists are available <a href="https://github.com/socdataR/wonderapi/tree/master/data-raw" class="external-link">here</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-customized-queries">Creating customized queries<a class="anchor" aria-label="anchor" href="#creating-customized-queries"></a>
</h2>
<p>There are different types of parameters. Most critical are Group Results By and Measures. The Group Results By parameters serve as keys for grouping the data; the maximum number of Group Results By parameters is five. Limiting Variables may also be used to constrain results behind the scenes.</p>
<p>To make changes to the default list, first create a list of lists, wherein each nested list is a name-value pair. For example, the following changes the first (and currently only) “Group Results By” variable to Weekday:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Group Results By"</span>, <span class="st">"Weekday"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Detailed Mortality"</span>, <span class="va">mylist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 4</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="do">##   Weekday    Deaths Population     `Crude Rate`  </span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;         </span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="do">## 1 Sunday    8049406 Not Applicable Not Applicable</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="do">## 2 Monday    8120828 Not Applicable Not Applicable</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="do">## 3 Tuesday   8066322 Not Applicable Not Applicable</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="do">## 4 Wednesday 8074854 Not Applicable Not Applicable</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="do">## 5 Thursday  8087969 Not Applicable Not Applicable</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="do">## 6 Friday    8197715 Not Applicable Not Applicable</span></span></code></pre></div>
<p>As the set up is slightly different depending on the parameter type, more details on setting up the name-value pairs by parameter types are provided below.</p>
<div class="section level3">
<h3 id="group-by-variables">Group By variables<a class="anchor" aria-label="anchor" href="#group-by-variables"></a>
</h3>
<p>Each dataset allows for fixed number (5 or fewer) Group By variables, codes for which are <code>"B_1", "B_2", "B_3",</code> etc. <code>"Group By Results"</code> may be substituted for <code>"B_1"</code> and <code>"And By"</code> for <code>"B_2"</code>. <code>"And By</code>” may <strong>not</strong>, however, be substituted for <code>"B_3"</code> on to avoid ambiguity (this may change in the future.) Values – in this case, the Group By variables – may be specified by code or human readable name. The following, thus, are equivalent:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## not run</span></span>
<span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"B_1"</span>, <span class="st">"D66.V2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Group Results By"</span>, <span class="st">"Race"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"B_1"</span>, <span class="st">"Race"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Group Results By"</span>, <span class="st">"D66.V2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>See the appropriate codebook for all Group By options.</p>
</div>
<div class="section level3">
<h3 id="measures">Measures<a class="anchor" aria-label="anchor" href="#measures"></a>
</h3>
<p>Measures do not need values; it is sufficient to specify a name only:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Group Results By"</span>, <span class="st">"Marital Status"</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"And By"</span>, <span class="st">"Year"</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Average Age of Mother"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 2007 - 2022"</span>, <span class="va">mylist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 4</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="do">##   `Marital Status`  Year  Births `Average Age of Mother`</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;                   &lt;dbl&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="do">## 1 Married           2007 2601186                    29.5</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="do">## 2 Married           2008 2521128                    29.6</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="do">## 3 Married           2009 2437007                    29.7</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="do">## 4 Married           2010 2365915                    29.8</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="do">## 5 Married           2011 2345817                    29.9</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="do">## 6 Married           2012 2343222                    30.0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="limiting-variables">Limiting variables<a class="anchor" aria-label="anchor" href="#limiting-variables"></a>
</h3>
<p>Queries can be constrained with parameters that limit results in the background. For example, if you’re only interested in February births, you may choose to limit results to February as follows, rather than grouping by Month:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Month"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"D66"</span>, <span class="va">mylist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="do">## A tibble: 16 × 2</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="do">##    Year Births</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="do">##   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="do">##  1  2007 326891</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="do">##  2  2008 338521</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="do">##  3  2009 316641</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="do">##  4  2010 301994</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="do">##  5  2011 297961</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="do">##  6  2012 304505</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="do">##  7  2013 291748</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="do">##  8  2014 298404</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="do">##  9  2015 298058</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="do">## 10  2016 306015</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="do">## 11  2017 289054</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="do">## 12  2018 284250</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="do">## 13  2019 279963</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="do">## 14  2020 282654</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="do">## 15  2021 266355</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="do">## 16  2022 275727</span></span></code></pre></div>
<p><strong>Note that values for Limiting Variables must be entered as codes; in this case “2” rather than “February.” We hope to add capability for human readable values in the future.</strong></p>
</div>
<div class="section level3">
<h3 id="plotting-query-results">Plotting query results<a class="anchor" aria-label="anchor" href="#plotting-query-results"></a>
</h3>
<p>By returning a tidy data frame, the query results are ready to be plotted without any additional data manipulation:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mydata2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Births</span>, color <span class="op">=</span> <span class="va">`Marital Status`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Births by Marital Status"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/BirthsByMaritalStatus-2.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mydata2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">`Average Age of Mother`</span>,</span>
<span>                   color <span class="op">=</span> <span class="va">`Marital Status`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"age (in years)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Average Age of Mother"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/AverageAgeofMother-2.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata2</span> <span class="op">&lt;-</span> <span class="va">mydata2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`Average Age of Mother`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">`Marital Status`</span>, value <span class="op">=</span> <span class="va">`Births`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Total <span class="op">=</span> <span class="va">Married</span> <span class="op">+</span> <span class="va">Unmarried</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mydata2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Unmarried</span> <span class="op">/</span> <span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Births to Unmarried Mothers"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Percent of Total Births"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/BirthstoUnmarriedMothers-2.png" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="combining-results-from-multiple-datasets">Combining results from multiple datasets<a class="anchor" aria-label="anchor" href="#combining-results-from-multiple-datasets"></a>
</h3>
<p>Some of the datasets, such as the Births, are divided into multiple databases by time period. <code>wonderapi</code> makes it easy to combine the data into one data frame. (Care needs to be taken as the variables are not identical in all. For example, the 1995 - 2002 dataset does not have any measure options; it only returns number of births. To find out what’s available, see the codebooks (<strong><code>&gt;??codebook</code></strong>) and crosscheck with the <a href="https://wonder.cdc.gov" class="external-link">CDC Wonder API web interface</a>.)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">births</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 1995 - 2002"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 2003 - 2006"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 2007 - 2022"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">births</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Births</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"U.S. Births by Year, 1995 - 2022"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/BirthsbyYear1995to2022-1.png" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="errors">Errors<a class="anchor" aria-label="anchor" href="#errors"></a>
</h3>
<p>The main source of errors is improper query requests. The <code>wonderapi</code> package has some ability to catch problems before the query request is made but will not catch everything. It checks the list of parameter names and will reject the name-value pair if the <em>name</em>, either in code or human readable form, is not recognized or is a geographic variable not accessible through the API without permission. (Checking for <em>value</em> problems will be added in the future.) Here is an example of an unrecognized parameter name:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Detailed Mortality"</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Suspect"</span>, <span class="st">"Mrs. Peacock"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="do">## Ignoring: "Suspect",...(not recognized)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 4</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="do">##   Year   Deaths Population `Crude Rate`</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="do">## 1 1999  2391043  279040168         857.</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="do">## 2 2000  2402995  281421906         854.</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="do">## 3 2001  2416003  284968955         848.</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="do">## 4 2002  2443030  287625193         849.</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a><span class="do">## 5 2003  2447946  290107933         844.</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="do">## 6 2004  2397269  292805298         819.</span></span></code></pre></div>
<p>If the CDC Wonder API returns an error, the message in the response will be displayed. Sometimes the message will provide enough information to fix the problem. Other times, it is not. For example:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"And By"</span>, <span class="st">"Education"</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Birth Rate"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydata4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 2007 - 2020"</span>, <span class="va">mylist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="do">## No encoding supplied: defaulting to UTF-8.</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="do">## Message from query:</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="do">## Any by-variables picked from {0} need to appear in the order listed, and other by-variables can't come between them.</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="do">## Error in getData("Natality for 2007 - 2020", mylist): Internal Server Error (HTTP 500).</span></span></code></pre></div>
<p>In this case, the best approach is to visit the <a href="https://wonder.cdc.gov" class="external-link">CDC Wonder API web interface</a> and try the same query. If all goes well, you will receive more detailed information on what went wrong:</p>
<center>
<img src="reference/figures/NatalityError.png" width="432px">
</center>
<p>We learn that we can’t include “Education” if we request the “Birth Rate” measure. If we try again with “Bridged Race” instead of “Education”, it works:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"And By"</span>, <span class="st">"Mother's Bridged Race"</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Birth Rate"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydata5</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span><span class="st">"Natality for 2007 - 2020"</span>, <span class="va">mylist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="do">## # A tibble: 6 × 5</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="do">##    Year `Mother's Bridged Race`           Births `Total Population` `Birth Rate`</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="do">##   &lt;dbl&gt; &lt;chr&gt;                              &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;       </span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="do">## 1  2007 American Indian or Alaska Native   49443 3,829,898          12.91       </span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="do">## 2  2007 Asian or Pacific Islander         254488 15,559,373         16.36       </span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="do">## 3  2007 Black or African American         675676 40,451,108         16.70       </span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="do">## 4  2007 White                            3336626 241,390,828        13.82       </span></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a><span class="do">## 5  2008 American Indian or Alaska Native   49537 3,983,929          12.43       </span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a><span class="do">## 6  2008 Asian or Pacific Islander         253185 16,094,699         15.73</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/socdataR/wonderapi/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/socdataR/wonderapi/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing wonderapi</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Joyce Robbins <br><small class="roles"> Maintainer, author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joyce Robbins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
